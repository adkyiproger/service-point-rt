/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package ehospital.configurator;

import ehospital.model.Template;
import helpers.TextPropsDecorator;
import javax.swing.Icon;
//import ehospital.code.*;
//import ehospital.model.Doctor;
import javax.swing.JOptionPane;

/**
 *
 * @author pigeon
 */
public class ConfiguratorTemplateBean extends ConfiguratorAbstractBean {
    
    Template TEMPLATE=null;
    boolean SAVED=true;
    private java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("ehospital/code/Bundle"); // NOI18N
    /**
     * Creates new form ConfiguratorTemplateBean
     */
    public ConfiguratorTemplateBean() {
        initComponents();
        TextPropsDecorator.decorate(EDITOR);
        TABLE.setModel(Template.listTTemplates());
        //TABLE.setComponentPopupMenu(TABLE_MENU);
        hideColumns();
        setEditable(false);
    }
    public void save(){
        //SAVED = true;
        if (SAVED==false) {
        TEMPLATE.setName(this.NAME.getText());
        TEMPLATE.setContent(this.EDITOR.getText());
      
        TEMPLATE.save();
        System.out.println("ConfiguratorTemplateBean::save(): "+TEMPLATE.id());
        setEditable(false);
        TABLE.setModel(Template.listTTemplates());
        hideColumns();
        SAVED=true;
        }
    }
    public Icon getIcon() {
        return FORM_NAME.getIcon();
    }
    protected void hideColumns(){
        TABLE.getColumnModel().getColumn(0).setMinWidth(0);
        TABLE.getColumnModel().getColumn(0).setMaxWidth(0);
        TABLE.getColumnModel().getColumn(0).setWidth(0);
        TABLE.getColumnModel().getColumn(0).setPreferredWidth(0);
    
    }
    protected void setEditable(boolean state){
    NAME.setEditable(state);
    EDITOR.setEditable(state);
    SAVED=!state;
    }
    
    private void loadDepByID(int id){
        TEMPLATE=new Template(id);
        NAME.setText(TEMPLATE.getName());
        EDITOR.setText(TEMPLATE.getContent());
    }
public boolean OptionSave(){
        
            Object[] options = {bundle.getString("PatientForm.OPT_SAVECLOSE"), bundle.getString("PatientForm.OPT_CANCELRES")};
            int n = JOptionPane.showOptionDialog(this,bundle.getString("PatientForm.OPT_MSG"),bundle.getString("PatientForm.OPT_TITLE"),
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.ERROR_MESSAGE,
                    null,
                    options,
                    options[0]);
            System.out.println("options:" + options[n] + " N=" + n);
            if (n == 1) {
                return true;
            } else return false;

}
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        TABLE_MENU = new javax.swing.JPopupMenu();
        M_NEW = new javax.swing.JMenuItem();
        M_DUPLICATE = new javax.swing.JMenuItem();
        M_DELETE = new javax.swing.JMenuItem();
        M_EDIT = new javax.swing.JMenuItem();
        FORM_NAME = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        TABLE = new javax.swing.JTable(){
            public boolean isCellEditable(int rowIndex, int colIndex) {
                return false;   //Disallow the editing of any cell
            }
        };
        BTN_NEW_DEP = new javax.swing.JButton();
        BTN_SAVE = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        NAME = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        MASTER_BOX = new javax.swing.JComboBox();
        jScrollPane3 = new javax.swing.JScrollPane();
        EDITOR = new javax.swing.JTextArea();
        BTN_EDIT = new javax.swing.JButton();

        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("ehospital/configurator/Bundle"); // NOI18N
        M_NEW.setText(bundle.getString("ConfiguratorTemplateBean.M_NEW.text")); // NOI18N
        TABLE_MENU.add(M_NEW);

        M_DUPLICATE.setText(bundle.getString("ConfiguratorTemplateBean.M_DUPLICATE.text")); // NOI18N
        TABLE_MENU.add(M_DUPLICATE);

        M_DELETE.setText(bundle.getString("ConfiguratorTemplateBean.M_DELETE.text")); // NOI18N
        TABLE_MENU.add(M_DELETE);

        M_EDIT.setText(bundle.getString("ConfiguratorTemplateBean.M_EDIT.text")); // NOI18N
        TABLE_MENU.add(M_EDIT);

        FORM_NAME.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ehospital/images/must_have_icon_set/Text Document/Text Document_48x48.png"))); // NOI18N
        FORM_NAME.setText(bundle.getString("ConfiguratorTemplateBean.FORM_NAME.text")); // NOI18N

        setBorder(javax.swing.BorderFactory.createTitledBorder(bundle.getString("ConfiguratorTemplateBean.border.title"))); // NOI18N

        TABLE.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        TABLE.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                TABLEMouseClicked(evt);
            }
        });
        TABLE.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                TABLEKeyPressed(evt);
            }
        });
        jScrollPane1.setViewportView(TABLE);

        BTN_NEW_DEP.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ehospital/images/must_have_icon_set/New/New_24x24.png"))); // NOI18N
        BTN_NEW_DEP.setText(bundle.getString("ConfiguratorTemplateBean.BTN_NEW_DEP.text")); // NOI18N
        BTN_NEW_DEP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTN_NEW_DEPActionPerformed(evt);
            }
        });

        BTN_SAVE.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ehospital/images/must_have_icon_set/Save/Save_24x24.png"))); // NOI18N
        BTN_SAVE.setText(bundle.getString("ConfiguratorTemplateBean.BTN_SAVE.text")); // NOI18N
        BTN_SAVE.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTN_SAVEActionPerformed(evt);
            }
        });

        jLabel1.setText(bundle.getString("ConfiguratorTemplateBean.jLabel1.text")); // NOI18N

        jLabel8.setText(bundle.getString("ConfiguratorTemplateBean.jLabel8.text")); // NOI18N

        MASTER_BOX.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Дата обследования (DATE)", "Эпикриз (EPICRISIS)", "Фамилия (LNAME)", "Имя (FNAME)", "Очество (MNAME)", "Дата рождения (BIRTHDATE)", "Доктор (DOCTOR)", "Область (REGION)", "Район (DISTRICT)", "Нас. пункт (TOWN)", "Улица (STREET)" }));
        MASTER_BOX.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MASTER_BOXActionPerformed(evt);
            }
        });

        EDITOR.setColumns(20);
        EDITOR.setRows(5);
        jScrollPane3.setViewportView(EDITOR);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(NAME)
                            .addComponent(MASTER_BOX, 0, 239, Short.MAX_VALUE)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel8)
                                    .addComponent(jLabel1))
                                .addGap(0, 0, Short.MAX_VALUE)))
                        .addContainerGap())))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(NAME, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(7, 7, 7)
                .addComponent(MASTER_BOX, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane3))
        );

        BTN_EDIT.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ehospital/images/must_have_icon_set/Edit/Edit_24x24.png"))); // NOI18N
        BTN_EDIT.setText(bundle.getString("ConfiguratorTemplateBean.BTN_EDIT.text")); // NOI18N
        BTN_EDIT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTN_EDITActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(BTN_NEW_DEP)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(BTN_SAVE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(BTN_EDIT)
                        .addContainerGap())
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 232, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(BTN_NEW_DEP)
                    .addComponent(BTN_SAVE)
                    .addComponent(BTN_EDIT))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 263, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        getAccessibleContext().setAccessibleDescription(bundle.getString("ConfiguratorTemplateBean.AccessibleContext.accessibleDescription")); // NOI18N
    }// </editor-fold>//GEN-END:initComponents

    private void TABLEKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TABLEKeyPressed

        if (!SAVED) {
            if (OptionSave()) {
                this.save();
            }
        }

        if (evt.getKeyCode() == 10 && TABLE.getSelectedRow() > 0) {
            loadDepByID(Integer.parseInt(TABLE.getValueAt(TABLE.getSelectedRow(), 0).toString()));
        }
        if (evt.getKeyCode() == 38 && TABLE.getSelectedRow() > 0) {
            loadDepByID(Integer.parseInt(TABLE.getValueAt(TABLE.getSelectedRow(), 0).toString()) - 1);
        }
        if (evt.getKeyCode() == 40 && TABLE.getSelectedRow() < TABLE.getRowCount() - 1) {
            loadDepByID(Integer.parseInt(TABLE.getValueAt(TABLE.getSelectedRow(), 0).toString()) + 1);
        }
     //   System.out.println("Key Code: " + evt.getKeyCode() + " Selected row: " + TABLE.getSelectedRow());


    }//GEN-LAST:event_TABLEKeyPressed

    private void BTN_EDITActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTN_EDITActionPerformed
        // TODO add your handling code here:
        setEditable(true);
    }//GEN-LAST:event_BTN_EDITActionPerformed

    private void TABLEMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_TABLEMouseClicked
        int P_ID=-1;
        
        if(TABLE.getSelectedRow()>=0) 
            P_ID = Integer.parseInt(TABLE.getValueAt(TABLE.getSelectedRow(), 0).toString());
            
        if (!SAVED) {
            if (OptionSave()==true) {
                this.save();
            }
        }
        if (P_ID>=0) loadDepByID(P_ID);
    }//GEN-LAST:event_TABLEMouseClicked

    private void BTN_NEW_DEPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTN_NEW_DEPActionPerformed
        setEditable(true);
        TEMPLATE=new Template();
        NAME.setText("");
      
    }//GEN-LAST:event_BTN_NEW_DEPActionPerformed

    private void BTN_SAVEActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTN_SAVEActionPerformed
        // TODO add your handling code here:
        this.save();
    }//GEN-LAST:event_BTN_SAVEActionPerformed

    private void MASTER_BOXActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MASTER_BOXActionPerformed

        String str=MASTER_BOX.getSelectedItem().toString();
        int p1=str.indexOf("(");
        int p2=str.indexOf(")");
        EDITOR.insert(str.substring(p1+1, p2),EDITOR.getCaretPosition());
        
    }//GEN-LAST:event_MASTER_BOXActionPerformed
    @Override
    public String toString(){
        return java.util.ResourceBundle.getBundle("ehospital/configurator/Bundle").getString("ConfiguratorTemplateBean.border.title");
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BTN_EDIT;
    private javax.swing.JButton BTN_NEW_DEP;
    private javax.swing.JButton BTN_SAVE;
    private javax.swing.JTextArea EDITOR;
    private javax.swing.JLabel FORM_NAME;
    private javax.swing.JComboBox MASTER_BOX;
    private javax.swing.JMenuItem M_DELETE;
    private javax.swing.JMenuItem M_DUPLICATE;
    private javax.swing.JMenuItem M_EDIT;
    private javax.swing.JMenuItem M_NEW;
    private javax.swing.JTextField NAME;
    private javax.swing.JTable TABLE;
    private javax.swing.JPopupMenu TABLE_MENU;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    // End of variables declaration//GEN-END:variables
}
